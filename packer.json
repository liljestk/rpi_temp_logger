{
  "builders": [
    {
      "type": "docker",
      "image": "arm32v7/debian:bullseye",
      "commit": true
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline": [
        "apt-get update",
        "apt-get install -y docker.io",
        "systemctl start docker",
        "systemctl enable docker",
        "apt-get install -y docker-compose",
        "docker-compose --version",
        "git clone -b packer https://github.com/liljestk/rpi_temp_logger.git /app", 
        "cd /app",
        "docker-compose up -d"
      ]
    }
  ],
  "post-processors": [
    {
      "type": "manifest",
      "output": "output/{{.BuildName}}.json"
    },
    {
      "type": "shell",
      "inline": [
        "curl -X POST \
        -H 'Authorization: token ${PACKER_PAT}' \
        -d \'{\"tag_name\":\"v1.0.0\",\"target_commitish\":\"packer\",\"name\":\"Release v1.0.0\",\"body\":\"Release notes\",\"draft\":false,\"prerelease\":false}\' \
        https://api.github.com/repos/liljestk/rpi_temp_logger/releases"
      ]
    }
  ]
}
